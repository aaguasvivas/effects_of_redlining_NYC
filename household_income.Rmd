---
title: "household_income"
author: "Adelson Aguasvivas"
date: "4/25/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(tidyverse)
library(janitor)
library(sf)
library(rgdal)
library(tidycensus)
library(scales)
library(gt)
library(gridExtra)
library(lemon)
library(rvest)
library(magrittr)
library(leaflet)
library(gganimate)
library(spdplyr)
library(rmapshaper)



```


```{r manhattan-ny1950census, include=FALSE}

# Import Census Tract Data as data.frame Consult
# nhgis0013_ds82_1950_tract_codebook.txt codebook file to determine that column
# B0F001 contains Median Income in 1949. Rename this MedianHHIncome for clarity.
# Will need to figure out what the income variables are called for each new year
# of data you download from the codebook that comes with each NHGIS download.
# Select only MedianHHIncome and GISJOIN variables. GISJOIN is the variable that
# allows you to join the census tract median income data with the shapefile
# data. Also drop census tracts which reported 0 median income

data1950 <- read.csv("raw-data/householdincomedata/1950/nhgis0001_csv/nhgis0001_ds82_1950_tract.csv")%>%
  filter(STATE == "New York" & B0F001 > 0) %>%
  mutate(MedianHHIncome1949 = B0F001) %>%
  select(GISJOIN,MedianHHIncome1949)

# Import Census Tract Shapefile into R as SpatialPolygonsDataFrameFormat (SP Dataframe)
# dsn is location of folder which contains shapefiles, (.proj, .shp etc.)
# layer is the filename of the .shp file inside the
# folder dsn points to. 

tracts1950 <- sf::st_read(dsn = 
                            "raw-data/householdincomedata/1950/nhgis0001_shape/nhgis0001_shapefile_tl2008_us_tract_1950/",
                         layer = "US_tract_1950_conflated")

# *Select New York observations only using NHGISST variable NHGISST should be
# consistent between census years, but you might need to double-check this if
# you try 1960, 1970. *The NHGISST code is 360 for New York because New York's
# FIPS code is 360. Google New York FIPS code for more information about the
# FIPS system. *Need to have spdplyr package loaded to use tidyverse commands on
# SpatialPolygonsDataFrame aka `filter' and 'mutate' *Join the data1950 data
# with the MedianHHIncome variable by 'GISJOIN' so that the tract lines and
# income data are in one object *Subset to Manhattan county, which has FIPS code
# 061 *Can see other NY county fips codes at
# https://simple.wikipedia.org/wiki/List_of_counties_in_New_York

tracts1950 <-
  tracts1950 %>% filter(NHGISST == "360" & COUNTY == "061")%>%
  merge(data1950, "GISJOIN")


# Set projection of tracts dataset to `projection` required by leaflet

tracts1950 <- sf::st_transform(tracts1950,  crs="+init=epsg:4326")

# Condense size of data for faster processing

tracts1950 <- rmapshaper::ms_simplify(tracts1950)

# Set palette color

write_rds(tracts1950, "shiny/household_income/manhattan/1950/household_income_1950.rds")

pal <- colorNumeric("viridis", NULL)



#  Plot the data

leaflet(tracts1950) %>%
  addTiles() %>%
  addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 1,
              fillColor = ~pal(MedianHHIncome1949)) %>%
  addLegend(pal = pal, values = ~MedianHHIncome1949, opacity = 1.0)



```

```{r ny1960census, include=FALSE}

# Import Census Tract Data as data.frame Consult
# nhgis0013_ds82_1950_tract_codebook.txt codebook file to determine that column
# B0F001 contains Median Income in 1949. Rename this MedianHHIncome for clarity.
# Will need to figure out what the income variables are called for each new year
# of data you download from the codebook that comes with each NHGIS download.
# Select only MedianHHIncome and GISJOIN variables. GISJOIN is the variable that
# allows you to join the census tract median income data with the shapefile
# data. Also drop census tracts which reported 0 median income

nhgis0013_csv/nhgis0013_ds82_1950_tract.csv

data1960 <- read.csv("raw-data/householdincomedata/1960/nhgis0002_csv/nhgis0002_ds92_1960_tract.csv")%>%
  filter(STATE == "New York" & B8W001 > 0 & B8W002 > 0) %>%
  mutate(lessthan1000 = B8W001, 
         one_thousand_to_two_thousand = B8W002)%>%
  select(GISJOIN, lessthan1000, one_thousand_to_two_thousand)

# Import Census Tract Shapefile into R as SpatialPolygonsDataFrameFormat (SP Dataframe)
# dsn is location of folder which contains shapefiles, (.proj, .shp etc.)
# layer is the filename of the .shp file inside the
# folder dsn points to. 



tracts1960 <- sf::st_read(dsn = 
                            "raw-data/householdincomedata/1960/nhgis0002_shape/nhgis0002_shapefile_tl2008_us_tract_1960/",
                         layer = "US_tract_1960_conflated")

# *Select New York observations only using NHGISST variable NHGISST should be
# consistent between census years, but you might need to double-check this if
# you try 1960, 1970. *The NHGISST code is 360 for New York because New York's
# FIPS code is 360. Google New York FIPS code for more information about the
# FIPS system. *Need to have spdplyr package loaded to use tidyverse commands on
# SpatialPolygonsDataFrame aka `filter' and 'mutate' *Join the data1950 data
# with the MedianHHIncome variable by 'GISJOIN' so that the tract lines and
# income data are in one object *Subset to Manhattan county, which has FIPS code
# 061 *Can see other NY county fips codes at
# https://simple.wikipedia.org/wiki/List_of_counties_in_New_York

tracts1960 <-
  tracts1960 %>% filter(NHGISST == "360" & COUNTY == "061")%>%
  merge(data1960, "GISJOIN")


# Set projection of tracts dataset to `projection` required by leaflet

tracts1960 <- sf::st_transform(tracts1960,  crs="+init=epsg:4326")

# Condense size of data for faster processing

tracts1960 <- rmapshaper::ms_simplify(tracts1960)

# Set palette color

pal <- colorNumeric("viridis", NULL)

#  Plot the data

leaflet(tracts1960) %>%
  addTiles() %>%
  addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 1,
              fillColor = ~pal(lessthan1000)) %>%
  addLegend(pal = pal, values = ~c(lessthan1000, 
                                   one_thousand_to_two_thousand), opacity = 1.0)




```

```{r ny1970census, include=FALSE}

# Import Census Tract Data as data.frame Consult
# nhgis0013_ds82_1950_tract_codebook.txt codebook file to determine that column
# B0F001 contains Median Income in 1949. Rename this MedianHHIncome for clarity.
# Will need to figure out what the income variables are called for each new year
# of data you download from the codebook that comes with each NHGIS download.
# Select only MedianHHIncome and GISJOIN variables. GISJOIN is the variable that
# allows you to join the census tract median income data with the shapefile
# data. Also drop census tracts which reported 0 median income

data1950 <- read.csv("raw-data/nhgis0013_csv/nhgis0013_ds82_1950_tract.csv")%>%
  filter(STATE == "New York" & B0F001 > 0)%>%
  mutate(MedianHHIncome1949 = B0F001)%>%
  select(GISJOIN,MedianHHIncome1949)

# Import Census Tract Shapefile into R as SpatialPolygonsDataFrameFormat (SP Dataframe)
# dsn is location of folder which contains shapefiles, (.proj, .shp etc.)
# layer is the filename of the .shp file inside the
# folder dsn points to. 

tracts1950 <- sf::st_read(dsn = "raw-data/nhgis0012_shape/nhgis0012_shapefile_tl2008_us_tract_1950",
                         layer = "US_tract_1950_conflated")

# *Select New York observations only using NHGISST variable NHGISST should be
# consistent between census years, but you might need to double-check this if
# you try 1960, 1970. *The NHGISST code is 360 for New York because New York's
# FIPS code is 360. Google New York FIPS code for more information about the
# FIPS system. *Need to have spdplyr package loaded to use tidyverse commands on
# SpatialPolygonsDataFrame aka `filter' and 'mutate' *Join the data1950 data
# with the MedianHHIncome variable by 'GISJOIN' so that the tract lines and
# income data are in one object *Subset to Manhattan county, which has FIPS code
# 061 *Can see other NY county fips codes at
# https://simple.wikipedia.org/wiki/List_of_counties_in_New_York

tracts1950 <-
  tracts1950 %>% filter(NHGISST == "360" & COUNTY=="061")%>%
  merge(data1950, "GISJOIN")


# Set projection of tracts dataset to `projection` required by leaflet

tracts1950<-sf::st_transform(tracts1950,  crs="+init=epsg:4326")

# Condense size of data for faster processing

tracts1950<- rmapshaper::ms_simplify(tracts1950)

# Set palette color

pal <- colorNumeric("viridis", NULL)

#  Plot the data

leaflet(tracts1950) %>%
  addTiles() %>%
  addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 1,
              fillColor = ~pal(MedianHHIncome1949)) %>%
  addLegend(pal = pal, values = ~MedianHHIncome1949, opacity = 1.0)



```

```{r ny1980census, include=FALSE}

# Import Census Tract Data as data.frame Consult
# nhgis0013_ds82_1950_tract_codebook.txt codebook file to determine that column
# B0F001 contains Median Income in 1949. Rename this MedianHHIncome for clarity.
# Will need to figure out what the income variables are called for each new year
# of data you download from the codebook that comes with each NHGIS download.
# Select only MedianHHIncome and GISJOIN variables. GISJOIN is the variable that
# allows you to join the census tract median income data with the shapefile
# data. Also drop census tracts which reported 0 median income

manhattandata1980 <- 
  read.csv("raw-data/householdincomedata/1980/nhgis0004_csv/nhgis0004_ds107_1980_tract.csv") %>%
  filter(STATE == "New York" & DIE001 > 0) %>%
  mutate(MedianHHIncome1979 = DIE001) %>%
  select(GISJOIN, MedianHHIncome1979)

# Import Census Tract Shapefile into R as SpatialPolygonsDataFrameFormat (SP Dataframe)
# dsn is location of folder which contains shapefiles, (.proj, .shp etc.)
# layer is the filename of the .shp file inside the
# folder dsn points to. 

tracts1980 <- sf::st_read(dsn = "raw-data/householdincomedata/1980/nhgis0004_shape/nhgis0004_shapefile_tl2008_us_tract_1980/",
                         layer = "US_tract_1980_conflated")

# *Select New York observations only using NHGISST variable NHGISST should be
# consistent between census years, but you might need to double-check this if
# you try 1960, 1970. *The NHGISST code is 360 for New York because New York's
# FIPS code is 360. Google New York FIPS code for more information about the
# FIPS system. *Need to have spdplyr package loaded to use tidyverse commands on
# SpatialPolygonsDataFrame aka `filter' and 'mutate' *Join the data1950 data
# with the MedianHHIncome variable by 'GISJOIN' so that the tract lines and
# income data are in one object *Subset to Manhattan county, which has FIPS code
# 061 *Can see other NY county fips codes at
# https://simple.wikipedia.org/wiki/List_of_counties_in_New_York

tracts1980 <-
  tracts1980 %>% filter(NHGISST == "360" & COUNTY=="061")%>%
  merge(manhattandata1980, "GISJOIN")


# Set projection of tracts dataset to `projection` required by leaflet

tracts1980 <- sf::st_transform(tracts1980, crs="+init=epsg:4326")

# Condense size of data for faster processing

tracts1980 <- rmapshaper::ms_simplify(tracts1980)

# Set palette color

pal <- colorNumeric("viridis", NULL)

#  Plot the data

leaflet(tracts1980) %>%
  addTiles() %>%
  addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 1,
              fillColor = ~pal(MedianHHIncome1979)) %>%
  addLegend(pal = pal, values = ~MedianHHIncome1979, opacity = 1.0)



```

```{r ny1990census, include=FALSE}

# Import Census Tract Data as data.frame Consult
# nhgis0013_ds82_1950_tract_codebook.txt codebook file to determine that column
# B0F001 contains Median Income in 1949. Rename this MedianHHIncome for clarity.
# Will need to figure out what the income variables are called for each new year
# of data you download from the codebook that comes with each NHGIS download.
# Select only MedianHHIncome and GISJOIN variables. GISJOIN is the variable that
# allows you to join the census tract median income data with the shapefile
# data. Also drop census tracts which reported 0 median income

data1950 <- read.csv("raw-data/nhgis0013_csv/nhgis0013_ds82_1950_tract.csv")%>%
  filter(STATE == "New York" & B0F001 > 0)%>%
  mutate(MedianHHIncome1949 = B0F001)%>%
  select(GISJOIN,MedianHHIncome1949)

# Import Census Tract Shapefile into R as SpatialPolygonsDataFrameFormat (SP Dataframe)
# dsn is location of folder which contains shapefiles, (.proj, .shp etc.)
# layer is the filename of the .shp file inside the
# folder dsn points to. 

tracts1950 <- sf::st_read(dsn = "raw-data/nhgis0012_shape/nhgis0012_shapefile_tl2008_us_tract_1950",
                         layer = "US_tract_1950_conflated")

# *Select New York observations only using NHGISST variable NHGISST should be
# consistent between census years, but you might need to double-check this if
# you try 1960, 1970. *The NHGISST code is 360 for New York because New York's
# FIPS code is 360. Google New York FIPS code for more information about the
# FIPS system. *Need to have spdplyr package loaded to use tidyverse commands on
# SpatialPolygonsDataFrame aka `filter' and 'mutate' *Join the data1950 data
# with the MedianHHIncome variable by 'GISJOIN' so that the tract lines and
# income data are in one object *Subset to Manhattan county, which has FIPS code
# 061 *Can see other NY county fips codes at
# https://simple.wikipedia.org/wiki/List_of_counties_in_New_York

tracts1950 <-
  tracts1950 %>% filter(NHGISST == "360" & COUNTY=="061")%>%
  merge(data1950, "GISJOIN")


# Set projection of tracts dataset to `projection` required by leaflet

tracts1950<-sf::st_transform(tracts1950,  crs="+init=epsg:4326")

# Condense size of data for faster processing

tracts1950<- rmapshaper::ms_simplify(tracts1950)

# Set palette color

pal <- colorNumeric("viridis", NULL)

#  Plot the data

leaflet(tracts1950) %>%
  addTiles() %>%
  addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 1,
              fillColor = ~pal(MedianHHIncome1949)) %>%
  addLegend(pal = pal, values = ~MedianHHIncome1949, opacity = 1.0)



```

```{r ny2000census, include=FALSE}

# Import Census Tract Data as data.frame Consult
# nhgis0013_ds82_1950_tract_codebook.txt codebook file to determine that column
# B0F001 contains Median Income in 1949. Rename this MedianHHIncome for clarity.
# Will need to figure out what the income variables are called for each new year
# of data you download from the codebook that comes with each NHGIS download.
# Select only MedianHHIncome and GISJOIN variables. GISJOIN is the variable that
# allows you to join the census tract median income data with the shapefile
# data. Also drop census tracts which reported 0 median income

data1950 <- read.csv("raw-data/nhgis0013_csv/nhgis0013_ds82_1950_tract.csv")%>%
  filter(STATE == "New York" & B0F001 > 0)%>%
  mutate(MedianHHIncome1949 = B0F001)%>%
  select(GISJOIN,MedianHHIncome1949)

# Import Census Tract Shapefile into R as SpatialPolygonsDataFrameFormat (SP Dataframe)
# dsn is location of folder which contains shapefiles, (.proj, .shp etc.)
# layer is the filename of the .shp file inside the
# folder dsn points to. 

tracts1950 <- sf::st_read(dsn = "raw-data/nhgis0012_shape/nhgis0012_shapefile_tl2008_us_tract_1950",
                         layer = "US_tract_1950_conflated")

# *Select New York observations only using NHGISST variable NHGISST should be
# consistent between census years, but you might need to double-check this if
# you try 1960, 1970. *The NHGISST code is 360 for New York because New York's
# FIPS code is 360. Google New York FIPS code for more information about the
# FIPS system. *Need to have spdplyr package loaded to use tidyverse commands on
# SpatialPolygonsDataFrame aka `filter' and 'mutate' *Join the data1950 data
# with the MedianHHIncome variable by 'GISJOIN' so that the tract lines and
# income data are in one object *Subset to Manhattan county, which has FIPS code
# 061 *Can see other NY county fips codes at
# https://simple.wikipedia.org/wiki/List_of_counties_in_New_York

tracts1950 <-
  tracts1950 %>% filter(NHGISST == "360" & COUNTY=="061")%>%
  merge(data1950, "GISJOIN")


# Set projection of tracts dataset to `projection` required by leaflet

tracts1950<-sf::st_transform(tracts1950,  crs="+init=epsg:4326")

# Condense size of data for faster processing

tracts1950<- rmapshaper::ms_simplify(tracts1950)

# Set palette color

pal <- colorNumeric("viridis", NULL)

#  Plot the data

leaflet(tracts1950) %>%
  addTiles() %>%
  addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 1,
              fillColor = ~pal(MedianHHIncome1949)) %>%
  addLegend(pal = pal, values = ~MedianHHIncome1949, opacity = 1.0)



```

```{r ny2010census, include=FALSE}

# Import Census Tract Data as data.frame Consult
# nhgis0013_ds82_1950_tract_codebook.txt codebook file to determine that column
# B0F001 contains Median Income in 1949. Rename this MedianHHIncome for clarity.
# Will need to figure out what the income variables are called for each new year
# of data you download from the codebook that comes with each NHGIS download.
# Select only MedianHHIncome and GISJOIN variables. GISJOIN is the variable that
# allows you to join the census tract median income data with the shapefile
# data. Also drop census tracts which reported 0 median income

data1950 <- read.csv("raw-data/nhgis0013_csv/nhgis0013_ds82_1950_tract.csv")%>%
  filter(STATE == "New York" & B0F001 > 0)%>%
  mutate(MedianHHIncome1949 = B0F001)%>%
  select(GISJOIN,MedianHHIncome1949)

# Import Census Tract Shapefile into R as SpatialPolygonsDataFrameFormat (SP Dataframe)
# dsn is location of folder which contains shapefiles, (.proj, .shp etc.)
# layer is the filename of the .shp file inside the
# folder dsn points to. 

tracts1950 <- sf::st_read(dsn = "raw-data/nhgis0012_shape/nhgis0012_shapefile_tl2008_us_tract_1950",
                         layer = "US_tract_1950_conflated")

# *Select New York observations only using NHGISST variable NHGISST should be
# consistent between census years, but you might need to double-check this if
# you try 1960, 1970. *The NHGISST code is 360 for New York because New York's
# FIPS code is 360. Google New York FIPS code for more information about the
# FIPS system. *Need to have spdplyr package loaded to use tidyverse commands on
# SpatialPolygonsDataFrame aka `filter' and 'mutate' *Join the data1950 data
# with the MedianHHIncome variable by 'GISJOIN' so that the tract lines and
# income data are in one object *Subset to Manhattan county, which has FIPS code
# 061 *Can see other NY county fips codes at
# https://simple.wikipedia.org/wiki/List_of_counties_in_New_York

tracts1950 <-
  tracts1950 %>% filter(NHGISST == "360" & COUNTY=="061")%>%
  merge(data1950, "GISJOIN")


# Set projection of tracts dataset to `projection` required by leaflet

tracts1950<-sf::st_transform(tracts1950,  crs="+init=epsg:4326")

# Condense size of data for faster processing

tracts1950<- rmapshaper::ms_simplify(tracts1950)

# Set palette color

pal <- colorNumeric("viridis", NULL)

#  Plot the data

leaflet(tracts1950) %>%
  addTiles() %>%
  addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 1,
              fillColor = ~pal(MedianHHIncome1949)) %>%
  addLegend(pal = pal, values = ~MedianHHIncome1949, opacity = 1.0)


```